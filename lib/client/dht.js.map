{"version":3,"sources":["../../src/client/dht.js"],"names":["opts","put","callbackify","variadic","get","findprovs","res","Promise","all","map","item","resolve","findpeer","provide","query"],"mappings":";;;;;;kBAOe,UAAUA,IAAV,EAAgB;AAC7B,SAAO;AACLC,SAAKC,sBAAYC,QAAZ,CAAqB,wBAAO,cAAP,EAAuBH,IAAvB,CAArB,CADA;AAELI,SAAKF,sBAAYC,QAAZ,CAAqB,wBAAO,cAAP,EAAuBH,IAAvB,CAArB,CAFA;AAGLK,eAAWH,sBAAYC,QAAZ,CACT,kBACE,6BAAgB,CAAhB,CADF,EAEE,mBACE,wBAAO,oBAAP,EAA6BH,IAA7B,CADF,EAEE,UAACM,GAAD;AAAA,aAASC,QAAQC,GAAR,CACPF,IAAIG,GAAJ,CAAQ,UAACC,IAAD;AAAA,eAAU,sBAAWA,IAAX,IAAmB,4BAAiBA,IAAjB,CAAnB,GAA4CH,QAAQI,OAAR,CAAgBD,IAAhB,CAAtD;AAAA,OAAR,CADO,CAAT;AAAA,KAFF,CAFF,CADS,CAHN;AAcLE,cAAUV,sBAAYC,QAAZ,CACR,kBACE,2BAAgB,CAAhB,CADF,EAEE,mBACE,wBAAO,mBAAP,EAA4BH,IAA5B,CADF,EAEE,UAACM,GAAD;AAAA,aAAS,sBAAWA,GAAX,IAAkB,4BAAiBA,GAAjB,CAAlB,GAA0CA,GAAnD;AAAA,KAFF,CAFF,CADQ,CAdL;AAuBLO,aAASX,sBAAYC,QAAZ,CACP,kBACE,6BAAgB,CAAhB,CADF,EAEE,oCAAuB,CAAvB,CAFF,EAGE,uBAAa,CAAb,CAHF,EAIE,8BAAoB,CAApB,CAJF,EAKE,wBAAO,kBAAP,EAA2BH,IAA3B,CALF,CADO,CAvBJ;AAgCLc,WAAOZ,sBAAYC,QAAZ,CACL,kBACE,2BAAgB,CAAhB,CADF,EAEE,mBACE,wBAAO,gBAAP,EAAyBH,IAAzB,CADF,EAEE,UAACM,GAAD;AAAA,aAASC,QAAQC,GAAR,CACPF,IAAIG,GAAJ,CAAQ,UAACC,IAAD;AAAA,eAAU,sBAAWA,IAAX,IAAmB,4BAAiBA,IAAjB,CAAnB,GAA4CH,QAAQI,OAAR,CAAgBD,IAAhB,CAAtD;AAAA,OAAR,CADO,CAAT;AAAA,KAFF,CAFF,CADK;AAhCF,GAAP;AA4CD,C;;AApDD;;AACA;;;;AACA;;AACA;;AACA;;AACA","file":"dht.js","sourcesContent":["import { caller } from 'postmsg-rpc'\r\nimport callbackify from 'callbackify'\r\nimport { pre, post } from 'prepost'\r\nimport { preCidToJson, preArrayOfCidToJson } from '../serialization/cid'\r\nimport { prePeerIdToJson, peerInfoFromJson, isPeerInfo } from '../serialization/peer'\r\nimport { preBufferToJson, preArrayOfBufferToJson } from '../serialization/buffer'\r\n\r\nexport default function (opts) {\r\n  return {\r\n    put: callbackify.variadic(caller('ipfs.dht.put', opts)),\r\n    get: callbackify.variadic(caller('ipfs.dht.get', opts)),\r\n    findprovs: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        post(\r\n          caller('ipfs.dht.findprovs', opts),\r\n          (res) => Promise.all(\r\n            res.map((item) => isPeerInfo(item) ? peerInfoFromJson(item) : Promise.resolve(item))\r\n          )\r\n        )\r\n      )\r\n    ),\r\n    findpeer: callbackify.variadic(\r\n      pre(\r\n        prePeerIdToJson(0),\r\n        post(\r\n          caller('ipfs.dht.findpeer', opts),\r\n          (res) => isPeerInfo(res) ? peerInfoFromJson(res) : res\r\n        )\r\n      )\r\n    ),\r\n    provide: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        preArrayOfBufferToJson(0),\r\n        preCidToJson(0),\r\n        preArrayOfCidToJson(0),\r\n        caller('ipfs.dht.provide', opts)\r\n      )\r\n    ),\r\n    query: callbackify.variadic(\r\n      pre(\r\n        prePeerIdToJson(0),\r\n        post(\r\n          caller('ipfs.dht.query', opts),\r\n          (res) => Promise.all(\r\n            res.map((item) => isPeerInfo(item) ? peerInfoFromJson(item) : Promise.resolve(item))\r\n          )\r\n        )\r\n      )\r\n    )\r\n  }\r\n}\r\n"]}
{"version":3,"sources":["../../src/client/swarm.js"],"names":["opts","peers","callbackify","variadic","res","Promise","all","map","item","addr","peer","then","peerInfo","peerId","resolve","addrs","peerInfoFromJson","localAddrs","multiaddrFromJson","connect","disconnect"],"mappings":";;;;;;kBAOe,UAAUA,IAAV,EAAgB;AAC7B,SAAO;AACLC,WAAOC,sBAAYC,QAAZ,CACL,mBACE,wBAAO,kBAAP,EAA2BH,IAA3B,CADF,EAEE,UAACI,GAAD;AAAA,aAASC,QAAQC,GAAR,CACPF,IAAIG,GAAJ,CAAQ,UAACC,IAAD,EAAU;AAChBA,aAAKC,IAAL,GAAY,kCAAkBD,KAAKC,IAAvB,CAAZ;;AAEA;AACA,YAAI,0BAAeD,KAAKE,IAApB,CAAJ,EAA+B;AAC7B,iBAAO,4BAAiBF,KAAKE,IAAtB,EACJC,IADI,CACC,UAACC,QAAD,EAAc;AAClBJ,iBAAKE,IAAL,GAAYE,QAAZ;AACA,mBAAOJ,IAAP;AACD,WAJI,CAAP;AAKD,SAND,MAMO,IAAI,wBAAaA,KAAKE,IAAlB,CAAJ,EAA6B;AAClC,iBAAO,0BAAeF,KAAKE,IAApB,EACJC,IADI,CACC,UAACE,MAAD,EAAY;AAChBL,iBAAKE,IAAL,GAAYG,MAAZ;AACA,mBAAOL,IAAP;AACD,WAJI,CAAP;AAKD;;AAED,eAAOH,QAAQS,OAAR,CAAgBN,IAAhB,CAAP;AACD,OAnBD,CADO,CAAT;AAAA,KAFF,CADK,CADF;AA4BLO,WAAO,2BACL,mBACE,wBAAO,kBAAP,EAA2Bf,IAA3B,CADF,EAEE,UAACI,GAAD;AAAA,aAASC,QAAQC,GAAR,CAAYF,IAAIG,GAAJ,CAAQS,sBAAR,CAAZ,CAAT;AAAA,KAFF,CADK,CA5BF;AAkCLC,gBAAY,2BACV,mBACE,wBAAO,uBAAP,EAAgCjB,IAAhC,CADF,EAEE,UAACI,GAAD;AAAA,aAASA,IAAIG,GAAJ,CAAQW,4BAAR,CAAT;AAAA,KAFF,CADU,CAlCP;AAuCLC,aAASjB,sBAAYC,QAAZ,CACP,kBACE,6BAAgB,CAAhB,CADF,EAEE,mCAAmB,CAAnB,CAFF,EAGE,wBAAO,oBAAP,EAA6BH,IAA7B,CAHF,CADO,CAvCJ;AA8CLoB,gBAAYlB,sBAAYC,QAAZ,CACV,kBACE,6BAAgB,CAAhB,CADF,EAEE,mCAAmB,CAAnB,CAFF,EAGE,wBAAO,uBAAP,EAAgCH,IAAhC,CAHF,CADU;AA9CP,GAAP;AAsDD,C;;AA9DD;;AACA;;;;AACA;;AACA;;AACA;;AACA","file":"swarm.js","sourcesContent":["import { caller } from 'postmsg-rpc'\r\nimport callbackify from 'callbackify'\r\nimport { pre, post } from 'prepost'\r\nimport { peerInfoFromJson, peerIdFromJson, isPeerInfoJson, isPeerIdJson } from '../serialization/peer'\r\nimport { preMultiaddrToJson, multiaddrFromJson } from '../serialization/multiaddr'\r\nimport { preBufferToJson } from '../serialization/buffer'\r\n\r\nexport default function (opts) {\r\n  return {\r\n    peers: callbackify.variadic(\r\n      post(\r\n        caller('ipfs.swarm.peers', opts),\r\n        (res) => Promise.all(\r\n          res.map((item) => {\r\n            item.addr = multiaddrFromJson(item.addr)\r\n\r\n            // https://github.com/ipfs/js-ipfs/issues/1248\r\n            if (isPeerInfoJson(item.peer)) {\r\n              return peerInfoFromJson(item.peer)\r\n                .then((peerInfo) => {\r\n                  item.peer = peerInfo\r\n                  return item\r\n                })\r\n            } else if (isPeerIdJson(item.peer)) {\r\n              return peerIdFromJson(item.peer)\r\n                .then((peerId) => {\r\n                  item.peer = peerId\r\n                  return item\r\n                })\r\n            }\r\n\r\n            return Promise.resolve(item)\r\n          })\r\n        )\r\n      )\r\n    ),\r\n    addrs: callbackify(\r\n      post(\r\n        caller('ipfs.swarm.addrs', opts),\r\n        (res) => Promise.all(res.map(peerInfoFromJson))\r\n      )\r\n    ),\r\n    localAddrs: callbackify(\r\n      post(\r\n        caller('ipfs.swarm.localAddrs', opts),\r\n        (res) => res.map(multiaddrFromJson)\r\n      )),\r\n    connect: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        preMultiaddrToJson(0),\r\n        caller('ipfs.swarm.connect', opts)\r\n      )\r\n    ),\r\n    disconnect: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        preMultiaddrToJson(0),\r\n        caller('ipfs.swarm.disconnect', opts)\r\n      )\r\n    )\r\n  }\r\n}\r\n"]}
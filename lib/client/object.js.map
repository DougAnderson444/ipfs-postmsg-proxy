{"version":3,"sources":["../../src/client/object.js"],"names":["opts","new","callbackify","variadic","res","put","args","Data","Object","assign","get","data","bufferFromJson","links","map","dagLinkFromJson","stat","patch","addLink","dagNodeFromJson","rmLink","appendData","setData"],"mappings":"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","file":"object.js","sourcesContent":["import { caller } from 'postmsg-rpc'\r\nimport callbackify from 'callbackify'\r\nimport { pre, post } from 'prepost'\r\nimport { isDagNodeJson, preDagNodeToJson, dagNodeFromJson, preDagLinkToJson, dagLinkFromJson } from '../serialization/dag'\r\nimport { preCidToJson } from '../serialization/cid'\r\nimport { isBuffer, bufferFromJson, bufferToJson, preBufferToJson } from '../serialization/buffer'\r\n\r\nexport default function (opts) {\r\n  return {\r\n    new: callbackify.variadic(\r\n      post(\r\n        caller('ipfs.object.new', opts),\r\n        (res) => isDagNodeJson(res) ? dagNodeFromJson(res) : res\r\n      )\r\n    ),\r\n    put: callbackify.variadic(\r\n      pre(\r\n        preDagNodeToJson(0),\r\n        preBufferToJson(0),\r\n        (...args) => {\r\n          if (args[0] && isBuffer(args[0].Data)) {\r\n            args[0] = Object.assign({}, args[0], { Data: bufferToJson(args[0].Data) })\r\n          }\r\n\r\n          return args\r\n        },\r\n        post(\r\n          caller('ipfs.object.put', opts),\r\n          (res) => isDagNodeJson(res) ? dagNodeFromJson(res) : res\r\n        )\r\n      )\r\n    ),\r\n    get: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        preCidToJson(0),\r\n        post(\r\n          caller('ipfs.object.get', opts),\r\n          (res) => isDagNodeJson(res) ? dagNodeFromJson(res) : res\r\n        )\r\n      )\r\n    ),\r\n    data: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        preCidToJson(0),\r\n        post(\r\n          caller('ipfs.object.data', opts),\r\n          bufferFromJson\r\n        )\r\n      )\r\n    ),\r\n    links: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        preCidToJson(0),\r\n        post(\r\n          caller('ipfs.object.links', opts),\r\n          (res) => res.map(dagLinkFromJson)\r\n        )\r\n      )\r\n    ),\r\n    stat: callbackify.variadic(\r\n      pre(\r\n        preBufferToJson(0),\r\n        preCidToJson(0),\r\n        caller('ipfs.object.stat', opts)\r\n      )\r\n    ),\r\n    patch: {\r\n      addLink: callbackify.variadic(\r\n        pre(\r\n          preBufferToJson(0),\r\n          preCidToJson(0),\r\n          preDagLinkToJson(1),\r\n          post(\r\n            caller('ipfs.object.patch.addLink', opts),\r\n            dagNodeFromJson\r\n          )\r\n        )\r\n      ),\r\n      rmLink: callbackify.variadic(\r\n        pre(\r\n          preBufferToJson(0),\r\n          preCidToJson(0),\r\n          preDagLinkToJson(1),\r\n          post(\r\n            caller('ipfs.object.patch.rmLink', opts),\r\n            dagNodeFromJson\r\n          )\r\n        )\r\n      ),\r\n      appendData: callbackify.variadic(\r\n        pre(\r\n          preBufferToJson(0),\r\n          preCidToJson(0),\r\n          preBufferToJson(1),\r\n          post(\r\n            caller('ipfs.object.patch.appendData', opts),\r\n            dagNodeFromJson\r\n          )\r\n        )\r\n      ),\r\n      setData: callbackify.variadic(\r\n        pre(\r\n          preBufferToJson(0),\r\n          preCidToJson(0),\r\n          preBufferToJson(1),\r\n          post(\r\n            caller('ipfs.object.patch.setData', opts),\r\n            dagNodeFromJson\r\n          )\r\n        )\r\n      )\r\n    }\r\n  }\r\n}\r\n"]}
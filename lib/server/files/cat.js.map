{"version":3,"sources":["../../../src/server/files/cat.js"],"names":["getIpfs","opts","cat","pre","bufferToJson","catPullStream","res","Promise","resolve","readFnName","PMS","sink","Object","assign","post","data"],"mappings":";;;;;;kBASe,UAAUA,OAAV,EAAmBC,IAAnB,EAAyB;AACtC,SAAO;AACLC,SAAK,wBAAO,UAAP,EAAmB,kBACtB,+BAAkB,CAAlB,CADsB,EAEtB,yBAAe,CAAf,CAFsB,EAGtBD,KAAKE,GAAL,CAAS,KAAT,CAHsB,EAItB,mBACE;AAAA;;AAAA,aAAa,uBAAUD,GAAV,2BAAb;AAAA,KADF,EAEEE,oBAFF,CAJsB,CAAnB,EAQFH,IARE,CADA;AAULI,mBAAe,wBAAO,oBAAP,EAA6B,kBAC1C,+BAAkB,CAAlB,CAD0C,EAE1C,yBAAe,CAAf,CAF0C,EAG1CJ,KAAKE,GAAL,CAAS,eAAT,CAH0C,EAI1C,mBACE;AAAA;;AAAA,aAAa,wBAAUE,aAAV,4BAAb;AAAA,KADF,EAEE,UAACC,GAAD;AAAA,aAAS,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAChC,YAAMC,aAAa,wBAAnB;;AAEA,kCACEH,GADF,EAEEI,4BAAIC,IAAJ,CAASF,UAAT,EAAqBG,OAAOC,MAAP,CAAc,EAAd,EAAkBZ,IAAlB,EAAwB;AAC3Ca,cAD2C,gBACrCR,GADqC,EAChC;AACT,gBAAI,sBAASA,IAAIS,IAAb,CAAJ,EAAwB;AACtBT,kBAAIS,IAAJ,GAAW,0BAAaT,IAAIS,IAAjB,CAAX;AACD;;AAED,mBAAOT,GAAP;AACD;AAP0C,SAAxB,CAArB,CAFF;;AAaAE,gBAAQ,8BAAeC,UAAf,CAAR;AACD,OAjBQ,CAAT;AAAA,KAFF,CAJ0C,CAA7B,EAyBZR,IAzBY;AAVV,GAAP;AAqCD,C;;AA/CD;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA","file":"cat.js","sourcesContent":["import { expose } from 'postmsg-rpc'\r\nimport { pre, post } from 'prepost'\r\nimport pull from 'pull-stream'\r\nimport PMS from 'pull-postmsg-stream'\r\nimport shortid from 'shortid'\r\nimport { preCidFromJson } from '../../serialization/cid'\r\nimport { isBuffer, preBufferFromJson, bufferToJson } from '../../serialization/buffer'\r\nimport { functionToJson } from '../../serialization/function'\r\n\r\nexport default function (getIpfs, opts) {\r\n  return {\r\n    cat: expose('ipfs.cat', pre(\r\n      preBufferFromJson(0),\r\n      preCidFromJson(0),\r\n      opts.pre('cat'),\r\n      post(\r\n        (...args) => getIpfs().cat(...args),\r\n        bufferToJson\r\n      )\r\n    ), opts),\r\n    catPullStream: expose('ipfs.catPullStream', pre(\r\n      preBufferFromJson(0),\r\n      preCidFromJson(0),\r\n      opts.pre('catPullStream'),\r\n      post(\r\n        (...args) => getIpfs().catPullStream(...args),\r\n        (res) => new Promise((resolve) => {\r\n          const readFnName = shortid()\r\n\r\n          pull(\r\n            res,\r\n            PMS.sink(readFnName, Object.assign({}, opts, {\r\n              post (res) {\r\n                if (isBuffer(res.data)) {\r\n                  res.data = bufferToJson(res.data)\r\n                }\r\n\r\n                return res\r\n              }\r\n            }))\r\n          )\r\n\r\n          resolve(functionToJson(readFnName))\r\n        })\r\n      )\r\n    ), opts)\r\n  }\r\n}\r\n"]}
{"version":3,"sources":["../../src/server/dht.js"],"names":["getIpfs","opts","put","pre","dht","get","findprovs","res","map","item","findpeer","provide","query"],"mappings":";;;;;;kBAMe,UAAUA,OAAV,EAAmBC,IAAnB,EAAyB;AACtC,SAAO;AACLC,SAAK,wBAAO,cAAP,EAAuB,kBAC1BD,KAAKE,GAAL,CAAS,SAAT,CAD0B,EAE1B;AAAA;;AAAA,aAAa,0BAAUC,GAAV,EAAcF,GAAd,+BAAb;AAAA,KAF0B,CAAvB,EAGFD,IAHE,CADA;AAKLI,SAAK,wBAAO,cAAP,EAAuB,kBAC1BJ,KAAKE,GAAL,CAAS,SAAT,CAD0B,EAE1B;AAAA;;AAAA,aAAa,2BAAUC,GAAV,EAAcC,GAAd,gCAAb;AAAA,KAF0B,CAAvB,EAGFJ,IAHE,CALA;AASLK,eAAW,wBAAO,oBAAP,EAA6B,kBACtC,+BAAkB,CAAlB,CADsC,EAEtCL,KAAKE,GAAL,CAAS,eAAT,CAFsC,EAGtC,mBACE;AAAA;;AAAA,aAAa,2BAAUC,GAAV,EAAcE,SAAd,gCAAb;AAAA,KADF,EAEE,UAACC,GAAD;AAAA,aAASA,IAAIC,GAAJ,CAAQ,UAACC,IAAD;AAAA,eAAU,sBAAWA,IAAX,IAAmB,0BAAeA,IAAf,CAAnB,GAA0CA,IAApD;AAAA,OAAR,CAAT;AAAA,KAFF,CAHsC,CAA7B,EAORR,IAPQ,CATN;AAiBLS,cAAU,wBAAO,mBAAP,EAA4B,kBACpC,6BAAkB,CAAlB,CADoC,EAEpCT,KAAKE,GAAL,CAAS,cAAT,CAFoC,EAGpC,mBACE;AAAA;;AAAA,aAAa,2BAAUC,GAAV,EAAcM,QAAd,gCAAb;AAAA,KADF,EAEE,UAACH,GAAD;AAAA,aAAS,sBAAWA,GAAX,IAAkB,0BAAeA,GAAf,CAAlB,GAAwCA,GAAjD;AAAA,KAFF,CAHoC,CAA5B,EAOPN,IAPO,CAjBL;AAyBLU,aAAS,wBAAO,kBAAP,EAA2B,kBAClC,+BAAkB,CAAlB,CADkC,EAElC,sCAAyB,CAAzB,CAFkC,EAGlC,yBAAe,CAAf,CAHkC,EAIlC,gCAAsB,CAAtB,CAJkC,EAKlCV,KAAKE,GAAL,CAAS,aAAT,CALkC,EAMlC,mBACE;AAAA;;AAAA,aAAa,2BAAUC,GAAV,EAAcO,OAAd,gCAAb;AAAA,KADF;AAEE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA,aAAM,IAAN;AAAA,KAXF,CANkC,CAA3B,EAmBNV,IAnBM,CAzBJ;AA6CLW,WAAO,wBAAO,gBAAP,EAAyB,kBAC9B,6BAAkB,CAAlB,CAD8B,EAE9BX,KAAKE,GAAL,CAAS,WAAT,CAF8B,EAG9B,mBACE;AAAA;;AAAA,aAAa,2BAAUC,GAAV,EAAcQ,KAAd,gCAAb;AAAA,KADF,EAEE,UAACL,GAAD;AAAA,aAASA,IAAIC,GAAJ,CAAQ,UAACC,IAAD;AAAA,eAAU,sBAAWA,IAAX,IAAmB,0BAAeA,IAAf,CAAnB,GAA0CA,IAApD;AAAA,OAAR,CAAT;AAAA,KAFF,CAH8B,CAAzB,EAOJR,IAPI;AA7CF,GAAP;AAsDD,C;;AA7DD;;AACA;;AACA;;AACA;;AACA","file":"dht.js","sourcesContent":["import { expose } from 'postmsg-rpc'\r\nimport { pre, post } from 'prepost'\r\nimport { preCidFromJson, preArrayOfCidFromJson } from '../serialization/cid'\r\nimport { prePeerIdFromJson, peerInfoToJson, isPeerInfo } from '../serialization/peer'\r\nimport { preBufferFromJson, preArrayOfBufferFromJson } from '../serialization/buffer'\r\n\r\nexport default function (getIpfs, opts) {\r\n  return {\r\n    put: expose('ipfs.dht.put', pre(\r\n      opts.pre('dht.put'),\r\n      (...args) => getIpfs().dht.put(...args)\r\n    ), opts),\r\n    get: expose('ipfs.dht.get', pre(\r\n      opts.pre('dht.get'),\r\n      (...args) => getIpfs().dht.get(...args)\r\n    ), opts),\r\n    findprovs: expose('ipfs.dht.findprovs', pre(\r\n      preBufferFromJson(0),\r\n      opts.pre('dht.findprovs'),\r\n      post(\r\n        (...args) => getIpfs().dht.findprovs(...args),\r\n        (res) => res.map((item) => isPeerInfo(item) ? peerInfoToJson(item) : item)\r\n      )\r\n    ), opts),\r\n    findpeer: expose('ipfs.dht.findpeer', pre(\r\n      prePeerIdFromJson(0),\r\n      opts.pre('dht.findpeer'),\r\n      post(\r\n        (...args) => getIpfs().dht.findpeer(...args),\r\n        (res) => isPeerInfo(res) ? peerInfoToJson(res) : res\r\n      )\r\n    ), opts),\r\n    provide: expose('ipfs.dht.provide', pre(\r\n      preBufferFromJson(0),\r\n      preArrayOfBufferFromJson(0),\r\n      preCidFromJson(0),\r\n      preArrayOfCidFromJson(0),\r\n      opts.pre('dht.provide'),\r\n      post(\r\n        (...args) => getIpfs().dht.provide(...args),\r\n        // js-ipfs returns undefined\r\n        // js-ipfs-api -> go-ipfs returns the request stream, with no data\r\n        //\r\n        // https://ipfs.io/docs/api/#api-v0-dht-provide\r\n        // ^ Docs say some response should be sent, but nothing is returned in\r\n        // current implementations.\r\n        //\r\n        // Returning null here so structured clone doesn't error trying to clone\r\n        // a stream.\r\n        () => null\r\n      )\r\n    ), opts),\r\n    query: expose('ipfs.dht.query', pre(\r\n      prePeerIdFromJson(0),\r\n      opts.pre('dht.query'),\r\n      post(\r\n        (...args) => getIpfs().dht.query(...args),\r\n        (res) => res.map((item) => isPeerInfo(item) ? peerInfoToJson(item) : item)\r\n      )\r\n    ), opts)\r\n  }\r\n}\r\n"]}
{"version":3,"sources":["../../src/server/ls.js"],"names":["getIpfs","opts","ls","pre","lsPullStream","res","Promise","resolve","readFnName","PMS","sink"],"mappings":";;;;;;kBASe,UAAUA,OAAV,EAAmBC,IAAnB,EAAyB;AACtC,SAAO;AACLC,QAAI,wBAAO,SAAP,EAAkB,kBACpB,+BAAkB,CAAlB,CADoB,EAEpB,yBAAe,CAAf,CAFoB,EAGpBD,KAAKE,GAAL,CAAS,IAAT,CAHoB,EAIpB;AAAA;;AAAA,aAAa,uBAAUD,EAAV,2BAAb;AAAA,KAJoB,CAAlB,EAKDD,IALC,CADC;AAOLG,kBAAc,wBAAO,mBAAP,EAA4B,kBACxC,+BAAkB,CAAlB,CADwC,EAExC,yBAAe,CAAf,CAFwC,EAGxCH,KAAKE,GAAL,CAAS,cAAT,CAHwC,EAIxC,mBACE;AAAA;;AAAA,aAAa,wBAAUC,YAAV,4BAAb;AAAA,KADF,EAEE,UAACC,GAAD;AAAA,aAAS,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAChC,YAAMC,aAAa,wBAAnB;AACA,kCAAKH,GAAL,EAAUI,4BAAIC,IAAJ,CAASF,UAAT,EAAqBP,IAArB,CAAV;AACAM,gBAAQ,8BAAeC,UAAf,CAAR;AACD,OAJQ,CAAT;AAAA,KAFF,CAJwC,CAA5B,EAYXP,IAZW;AAPT,GAAP;AAqBD,C;;AA/BD;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA","file":"ls.js","sourcesContent":["import { expose } from 'postmsg-rpc'\r\nimport { pre, post } from 'prepost'\r\nimport pull from 'pull-stream'\r\nimport PMS from 'pull-postmsg-stream'\r\nimport shortid from 'shortid'\r\nimport { preCidFromJson } from '../serialization/cid'\r\nimport { preBufferFromJson } from '../serialization/buffer'\r\nimport { functionToJson } from '../serialization/function'\r\n\r\nexport default function (getIpfs, opts) {\r\n  return {\r\n    ls: expose('ipfs.ls', pre(\r\n      preBufferFromJson(0),\r\n      preCidFromJson(0),\r\n      opts.pre('ls'),\r\n      (...args) => getIpfs().ls(...args)\r\n    ), opts),\r\n    lsPullStream: expose('ipfs.lsPullStream', pre(\r\n      preBufferFromJson(0),\r\n      preCidFromJson(0),\r\n      opts.pre('lsPullStream'),\r\n      post(\r\n        (...args) => getIpfs().lsPullStream(...args),\r\n        (res) => new Promise((resolve) => {\r\n          const readFnName = shortid()\r\n          pull(res, PMS.sink(readFnName, opts))\r\n          resolve(functionToJson(readFnName))\r\n        })\r\n      )\r\n    ), opts)\r\n  }\r\n}\r\n"]}